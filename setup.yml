version: '3'

tasks:
  default:
    cmds:
      - echo "Installing dependencies"
      - task: dependencies

      - echo "Decrypt env"
      - task: env

      - echo "Link configs"
      - task: link

      - echo "Installing neovim"
      - task: install-neovim

      - echo "Installing starship"
      - task: install-starship

      - echo "install/update mise"
      - task: install-mise

  env:
      cmds:
      - zsh -c "source $CONFIGS_DIR/commands.sh; dec $CONFIGS_DIR/env.enc"

  dependencies:
    cmds:
      # mac
      - cmd: brew install git stow ripgrep unzip fd fzf tmux watch zoxide
        platforms: [darwin]
      - cmd: brew install --cask raycast alacritty
        platforms: [darwin]
      # linux
      - cmd: sudo apt update -y
        platforms: [linux]
      - cmd: sudo apt install -y stow git unzip fd-find fzf watch ripgrep zsh tmux build-essential libfuse2 zoxide
        platforms: [linux]

  link:
    cmds:
      - stow --ignore=".DS_Store" --target $HOME --dir $CONFIGS_DIR -R xbindkeys nvim git mise tmux starship zed lazygit vscode alacritty

  install-neovim:
    cmds:
    # mac
    - cmd: brew install neovim
      platforms: [darwin]
    # linux
    - cmd: mkdir -p $HOME/bin && cd $HOME/bin && curl -L https://github.com/neovim/neovim/releases/latest/download/nvim.appimage -o ~/bin/nvim && chmod u+x ~/bin/nvim
      platforms: [linux]

  install-starship:
    cmds:
    # mac
    - cmd: brew install starship
      platforms: [darwin]
    # linux
    - cmd: curl -sL https://starship.rs/install.sh -o ~/install_starship.sh && sh ~/install_starship.sh --yes && rm ~/install_starship.sh
      platforms: [linux]

  install-mise:
    cmds:
    # mac
    - cmd: brew install mise
      platforms: [darwin]
    # linux
    - cmd: curl -sL https://mise.jdx.dev/install.sh -o ~/install_mise.sh && sh ~/install_mise.sh && rm ~/install_mise.sh
      platforms: [linux]

    - mise install -y
